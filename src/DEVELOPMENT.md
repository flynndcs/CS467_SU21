## Development

[Architecture Diagram (VERY WIP)](https://lucid.app/lucidchart/invitations/accept/inv_0a8665be-2794-4854-8e4a-c162c88fc41e?viewport_loc=-291%2C-20%2C2718%2C1354%2C0_0)

- The repo currently implements minimal instances of 2 out of 4 services.
    - Gateway (gRPC with REST Proxy)
    - Product (gRPC)
    - *Network (gRPC) TBD* 
    - *Transport (gRPC) TBD*

- To clear the FoundationDB database of all key-value records, run the following commands:
    - `fdbcli`
    - `writemode on`
    - `clearrange "" \xFF`

- The **proto/service** folder contains the .proto files and the client and server code generated by the `buf` command. (The config for this is defined in the buf.yaml file)
    - ***.pb.go** files hold the generated information/structure for gRPC messages
    - **gateway_grpc.pb.go** holds the generated client and server code for the services.
    - **gateway.pb.gw.go** holds the generated code for the HTTP REST Proxy.

- The **proto/openapiv2** folder holds generated OpenAPI/Swagger documentation.
    - May be useful to serve somehow via the REST proxy.

- The **src/service** folder will hold directories for each service housing their core logic.
    - **/gateway/gatewayHandlers.go**
        - This file handles the response to each rpc action defined in the service.proto definition. 
    - **/gateway/gatewayServer.go**
        - This file instantiates the server for the service as specified by the generated code. 
    - **/gateway/productDelegators.go**
        - This file contains the handlers that delegate calls to product service.

- The **store** directory holds the FoundationDB implementation layer
    - FoundationDB is a key-value store meaning any create, read, update, delete operations operate on key-value pairs.
        - The current driver code uses strings for keys and encoded byte buffers for values which are deserialized from the protobuf messages and serialized back into protobuf messages upon retrieval.
    - Product Service
        - Each record is defined within a multi-element "categorySequence" and with a unique "name"- each provided categorySequence element provides more specificity about the categorization of a product when created or retrieved.
            - Example - a product categorySequence could be defined as ["Coffee", "Mexico"] and with name "foobar" to represent a coffee product from Mexico named "foobar". Similarly, ["Coffee", "Guatemala"] with name "baz"
            - Use the `product/range` endpoint with `?categorySequence=Coffee` to get the records for both Mexican coffee and Guatemalan coffee.
            - Use the `product` endpoint to get a single record which requires an exact categorySequence and name. `?name=foobar&categorySequence=Coffee&categorySequence=Mexico` will return only the record that has a categorySequence defined with ["Coffee", "Mexico"] and name "foobar"
            - Optionally, specify a expiration time for when this product expires - default is 24 hours from the time of creation.

        - Examples
            - Put
                - the gateway handler for PutProduct delegates to the product client's PutProduct handler which puts a value in FoundationDB using the product name as a key and a deserialized product name and random UUID for the value.
            - Get
                - the getProduct handler uses the product name as key to get the deserialized StoredProduct (byte representation of product name and random UUID) then serializes it into the StoredProduct format to be returned